## unreal笔记-->UI优化

以下提到的优化都非常重要

### 使用材质动画

UI动画会消耗cpu性能，如果需要尽量使用material来创建动画（是的，材质可以渲染动画），并且它是在gpu上进行处理更高效

### 强加载常用UI

如果一个UI非常频繁的被使用，那么它不应该被隐藏(hide)或销毁（delete），这会消耗大量性能

可以使用“折叠”可将其不可见但不是被隐藏或销毁，会一直保持加载的状态

### 使用无交互可见模式

让ui显示在画面上的选项有两种：可见（visiable）、可见无交互（non-hit）

如果这个ui不需要与鼠标进行交互，那么就应该设置为可见无交互

### 少使用画布

画布（canvas panels）会调用额外DrawCall

可以改为使用网格布（grid panel）替换画布，这个不会调用DrawCall

### 用定位格替代尺寸框

定位格（spacers）和尺寸框（size box）都可以产生一个空白占位槽以保持组件间距

但是尺寸框会计算其他多个组件的尺寸来得到自己应该有的尺寸，定位格需直接给定所以不会计算

因此需要组件间距时，使用定位格更好

### 尽量使用软引用

普通引用会把引用到的类全部创建对象都加载到内存里，即使没有用到这个对象

使用软引用则只会在使用时加载，即懒加载模式

### 复用部件

很多场景需要创建同一种部件（widget）（例如血条，图标等），这种部件每次创建都会调用一次完整的绘制渲染流程，效率很低

应该使用smeshwidget，效果就像ecs模式那样

### 使用名称插槽

名称插槽（named slot）可以在多个组件中复用，如果某个组件用到很多相同的可以使用这个

### 用栈加层级管理UI

首先将部件分层级，再分别放入该层级的栈中

分层级是为了切换整体ui，使用栈是为了链式的关闭和打开该层的ui

这样会更好管理一些需要关闭多个ui和ui切换的场景

### 使用viewmodel来监视数据

经常会使用UI显示游戏内数据，如果UI引用或者触发事件的方式来获取游戏内数据，会导致UI持有引用游戏内对象

为了解耦应使用viewmodel（需要UMG Viewmodel插件，创建蓝图时选择继承view model），它使用了MVVM模式对游戏对象进行监视，当监视的内容改变时会触发UI更新

### 无效UI

无效UI是使用了无效盒（Invalidation Box）组件的ui，它不会每帧都更新UI，只会在属性发生变化时更新

使用方法是在ui编辑器里拖拽InvalidationBox组件到层级检查器（hierarchy），将不用更新的ui都挂在它里面就好