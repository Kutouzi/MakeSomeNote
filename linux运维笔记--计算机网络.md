## linux运维笔记-->计算机网络

### 传输层协议

以ip加端口为主角

#### TCP：面向连接可靠的传输

##### 一、 数据传输的过程

- 开始三次握手流程：（体现连接）

  ```
  1. 客户端发送SYN
  2. 服务端回复SYN+ACK
  3. 客户端发送ACK
  
  注：三次握手完成后，开辟接收流和输出流的资源
  ```

- 传输中：（提现可靠）

  ```
  每次发送数据对方会给回确认的报文（这报文只做确认所以len=0）
  ```

- 结束四次分手流程：

  ```
  1. 客户端发送FIN
  2. 服务端回复FIN+ACK
  3. 服务端发送FIN （检查没有数据要发了才会发FIN）
  4. 客户端回复ACK
  
  注：四次分手完成后，释放接收流和输出流的资源
  ```

三次握手到四次分手不可被分割

##### 二、 套接字

​		套接字是源ip端口和目的ip端口的一个对应关系。结构是：“源ip:源port -> 目的ip:目的port”，四个元素组成。每一个元素不同都可以代表唯一的一个进程或线程（都是一个新的套接字/连接）。例如：10.0.1.5:61440 -> 10.0.2.44:80和10.0.1.5:61440 -> 10.0.5.12:80，这两条套接字虽然说用同一个端口号，但四个元素不完全相同，可以同时存在

​		客户端理论上可能0~65535随机端口号连接到服务器。服务器必须固定端口号。

注：套接字对应唯一的一个进程或线程，但并不代表一个进程或线程不能对应多个套接字（多路复用器）

##### 三、 心跳（keepalive）

- 应用层（用户层）：检测到连接不存在后是否连接到其他的服务器或重连此服务器
- 传输层（内核）：定时监测连接是否还存在



### 链路层协议

以MAC地址为主角

