## java笔记-->分布式下的高并发

​	在此之前，必须了解java多线程高并发内的锁问题。

### 压力测试工具

​	使用Apache JMeter

### 分布式服务的由来

​	分布式是需要巨量计算的情况下，将计算分给多个计算机进行处理的一种计算方法。

​	分布式服务是在高访问量下单个服务器出现了瓶颈，因此需要多个服务器分担处理业务。分布式服务简单说是服务器集群共同分担处理一种业务。

### 分布式的原则

​	CAP理论为分布式计算领域的公认定理，一个分布式系统最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项。

### 分布式下带来的问题与解决

#### 多台机器无法保证原子性

##### 方案：分布式锁

​	现在由于分布式部署服务器，在多台机器上有多个线程。由于普通的锁由本机器的JVM保证原子性，在不同机器上就不可保证，因此需要分布式锁。

​	可以直接使用开源项目Redisson来进行加锁和释放锁。其原理是使用lua脚本的原子性对redis加入一个lock key，其他集群机器需要判断此lock key是否存在，以此来保证串行地对redis的访问。并且对lock key设置自动过期时间，还在正在访问redis的进程开启新线程去定时地更新过期时间，以免访问未结束但提前过期的情况。

​	注：在此情况下访问redis时为串行，所以有性能问题。使用分段锁（ConcurrentHashMap）来进行优化。



#### Redis集群来不及同步

##### 方案：Apache Zookeeper



##### 方案：Redis集群缓存



#### 缓存与数据库双写不一致

##### 方案：读写锁

​	适用于读多写少的场景，直接使用开源项目Redisson提供的读写锁。
